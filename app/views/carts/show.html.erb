<div class="container mt-5">
  <h2 class="mb-4">üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>

  <% if session[:cart].blank? %>
    <div class="alert alert-info">
      –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ—Ä–æ–∂–Ω—è
    </div>

    <%= link_to "–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É",
          products_path,
          class: "btn btn-primary" %>

  <% else %>

    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>–¢–æ–≤–∞—Ä</th>
          <th>–¶—ñ–Ω–∞</th>
          <th style="width: 150px;">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
          <th>–°—É–º–∞</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <% total = 0 %>

        <% @cart_items.each do |product| %>
          <% quantity = session[:cart][product.id.to_s] %>
          <% sum = product.price * quantity %>
          <% total += sum %>

          <tr>
            <td>
              <strong><%= product.name %></strong>
            </td>

            <td>
              <%= number_to_currency(product.price, unit: "‚Ç¥") %>
            </td>

            <td>
              <%= form_with url: update_cart_path(product),
                    method: :patch,
                    local: true do %>

                <%= number_field_tag :quantity,
                      quantity,
                      min: 1,
                      class: "form-control mb-1" %>

                <%= submit_tag "–û–Ω–æ–≤–∏—Ç–∏",
                      class: "btn btn-sm btn-outline-primary w-100" %>
              <% end %>
            </td>

            <td>
              <%= number_to_currency(sum, unit: "‚Ç¥") %>
            </td>

            <td>
              <%= button_to "‚úï",
                    remove_cart_path(product),
                    method: :delete,
                    class: "btn btn-sm btn-outline-danger" %>
            </td>
          </tr>
        <% end %>
      </tbody>

      <tfoot>
        <tr>
          <th colspan="3" class="text-end">–†–∞–∑–æ–º:</th>
          <th colspan="2">
            <%= number_to_currency(total, unit: "‚Ç¥") %>
          </th>
        </tr>
      </tfoot>
    </table>

    <div class="d-flex gap-3">
      <%= link_to "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –ø–æ–∫—É–ø–∫–∏",
            products_path,
            class: "btn btn-secondary" %>

      <%= link_to "–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è",
        new_order_path,
        class: "btn btn-success" %>

    </div>

  <% end %>
</div>
